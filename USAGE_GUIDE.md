# 🚀 运行和监控指南

## 📋 快速开始

### 方法 1: 一键演示脚本（推荐）

```bash
# 运行交互式演示脚本
uv run python run_demo.py
```

这个脚本提供三种运行模式：
1. **仅 Web 监控界面** - 启动 FreqUI 查看策略状态
2. **完整监控模式** - 同时运行策略和监控界面  
3. **纯策略模式** - 只运行策略，适合生产环境

### 方法 2: 分步运行

#### 步骤 1: 下载数据
```bash
# 下载 BTC/USDT 的历史数据用于回测和运行
uv run freqtrade download-data --config config_demo.json --timeframe 1m --timerange 20240901- --exchange binance
```

#### 步骤 2: 启动 Web 监控界面
```bash
# 在终端 1 中启动 Web 服务器
uv run freqtrade webserver --config config_demo.json
```

访问: http://localhost:8080
- 用户名: `demo` 
- 密码: `demo123`

#### 步骤 3: 运行策略
```bash
# 在终端 2 中启动策略（干跑模式）
uv run freqtrade trade --config config_demo.json --dry-run
```

#### 步骤 4: 实时监控
```bash
# 在终端 3 中启动实时监控脚本
uv run python monitor_trades.py
```

## 📊 监控界面说明

### 1. FreqUI Web 界面 (http://localhost:8080)

**主要功能页面:**

📈 **Dashboard (仪表板)**
- 总体策略表现概览
- 盈亏曲线图
- 实时余额显示

💹 **Trades (交易)**
- 所有历史交易记录
- 交易详情和盈亏分析
- 按时间筛选和搜索

📊 **Performance (性能)**  
- 详细的策略统计数据
- 胜率、平均盈亏等指标
- 最大回撤分析

🔧 **Config (配置)**
- 实时查看和修改策略参数
- 交易对管理
- 风险参数调整

### 2. 命令行监控脚本

**monitor_trades.py** 提供实时命令行监控:

```
🔄 AdvancedMarketMakerV2 实时监控
⏰ 更新时间: 2024-09-02 15:30:45
================================================================================

💰 账户余额 (API):
   USDT: 可用=9500.0000, 锁定=500.0000, 总计=10000.0000
   BTC: 可用=0.0000, 锁定=0.0100, 总计=0.0100

📊 当前持仓 (2 个):
--------------------------------------------------------------------------------
交易对       方向   数量           开仓价     当前价     盈亏率    持续时间
--------------------------------------------------------------------------------
BTC/USDT     多头   0.005000      50000.0000 50050.0000 0.10%     5m
BTC/USDT     空头   0.005000      50100.0000 50050.0000 0.10%     3m

📈 最新交易记录:
--------------------------------------------------------------------------------
ID   交易对       方向   状态   数量           开仓价     盈亏率
--------------------------------------------------------------------------------
1    BTC/USDT     多头   进行中   0.005000      50000.0000 0.10%
2    BTC/USDT     空头   进行中   0.005000      50100.0000 0.10%

📊 交易统计:
   总交易: 2 | 进行中: 2 | 已完成: 0
   胜率: 0% | 平均盈亏: 0%
   累计盈亏: 0%

📦 库存状态:
--------------------------------------------------
交易对       多头           空头           净持仓
--------------------------------------------------
BTC/USDT     0.005000      0.005000      0.000000

💡 提示:
   - 访问 http://localhost:8080 查看 Web 界面 (用户名: demo, 密码: demo123)
   - 按 Ctrl+C 退出监控
   - 做市商策略会同时开多空单来赚取价差
```

## 🔍 关键监控指标

### 1. 订单状态监控

**多头订单 (买入)**
- 在当前价格下方挂买单
- 等待市场价格下跌成交
- 成交后持有多头头寸

**空头订单 (卖出)**  
- 在当前价格上方挂卖单
- 等待市场价格上涨成交
- 成交后持有空头头寸

### 2. 库存平衡监控

做市商策略的核心是保持库存平衡：

```python
# 理想状态
多头持仓 ≈ 空头持仓
净持仓 ≈ 0

# 库存失衡示例
多头持仓 = 0.010 BTC
空头持仓 = 0.005 BTC  
净持仓 = +0.005 BTC (偏多)
```

**失衡处理:**
- 偏多时：增加卖单数量，减少买单数量
- 偏空时：增加买单数量，减少卖单数量

### 3. 盈利机制

做市商通过**买卖价差**获利：

```
示例交易流程:
1. 当前价格: 50000 USDT
2. 策略挂单:
   - 买单: 49900 USDT (低 0.2%)
   - 卖单: 50100 USDT (高 0.2%)
3. 价格波动，双边成交
4. 价差收益: 200 USDT (0.4%)
```

## ⚙️ 参数调优指南

### 关键参数说明

**价差控制:**
```json
"spread_ratio": 0.002,        // 基础价差 0.2%
"min_spread_ratio": 0.001,    // 最小价差 0.1%  
"max_spread_ratio": 0.01      // 最大价差 1.0%
```

**订单大小:**
```json
"base_order_amount_ratio": 0.005,  // 每单占资金 0.5%
"max_position_ratio": 0.3          // 最大持仓占资金 30%
```

**库存管理:**
```json
"inventory_target_ratio": 0.5,           // 目标多空比例 50:50
"inventory_rebalance_threshold": 0.2     // 失衡阈值 20%
```

### 根据市场调整参数

**高波动市场:**
- 增加 `spread_ratio` (更大价差保护)
- 降低 `base_order_amount_ratio` (减少单笔风险)
- 提高 `volatility_threshold` (避免极端波动)

**低波动市场:**
- 减少 `spread_ratio` (提高成交率)
- 适当增加订单频率
- 放宽波动率限制

## 🛠️ 故障排除

### 常见问题

**1. 策略不下单**
```bash
# 检查日志
tail -f logs/freqtrade_demo.log | grep -i "AdvancedMarketMakerV2"

# 可能原因:
# - 波动率过高触发风险控制
# - 成交量不足
# - 价差计算异常
```

**2. 订单成交率低**
```bash
# 解决方案:
# - 减少 spread_ratio 值
# - 检查价格更新频率
# - 确认市场流动性
```

**3. 库存严重失衡**
```bash
# 检查:
# - inventory_rebalance_threshold 设置
# - 市场趋势是否过强
# - 调整策略参数平衡机制
```

### 调试模式

**启用详细日志:**
```json
// 在 config_demo.json 中添加
"logging": {
    "level": "INFO",
    "logfile": "logs/freqtrade_debug.log"
}
```

**回测验证:**
```bash
# 使用历史数据验证策略
uv run freqtrade backtesting --config config_demo.json --strategy AdvancedMarketMakerV2 --timerange 20240801-20240901
```

## 🔐 安全注意事项

### 干跑模式 vs 实盘交易

**当前配置 (安全的干跑模式):**
```json
"dry_run": true,              // 模拟交易，不会真实下单
"dry_run_wallet": 10000       // 模拟资金
```

**切换到实盘交易前:**
1. ✅ 充分的干跑测试
2. ✅ 参数调优和风险评估  
3. ✅ 设置真实的 API 密钥
4. ✅ 从小资金开始测试
5. ✅ 设置合理的风险限制

```json
// 实盘配置示例
{
    "dry_run": false,
    "stake_amount": 100,          // 每单100 USDT
    "max_open_trades": 5,         // 最多5个仓位
    "available_capital": 5000,    // 可用资金
    "exchange": {
        "key": "your_real_api_key",
        "secret": "your_real_secret"
    }
}
```

## 📞 获取帮助

如果遇到问题：

1. **查看日志文件:** `logs/freqtrade_demo.log`
2. **检查配置文件:** `config_demo.json`
3. **阅读策略代码:** `user_data/strategies/AdvancedMarketMakerV2.py`
4. **FreqTrade 官方文档:** https://www.freqtrade.io/

现在你已经有了完整的工具链来运行和监控 AdvancedMarketMakerV2 做市商策略！🎉