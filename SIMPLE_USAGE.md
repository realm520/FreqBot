# 🚀 简化版运行指南（无 webserver）

## 📋 快速开始

### 方法 1: 一键运行（推荐）

```bash
uv run python run_simple.py
```

这个脚本会：
- ✅ 自动检查依赖和配置
- ✅ 可选下载最新市场数据
- ✅ 运行做市商策略（干跑模式）
- ✅ 实时监控交易状态

### 方法 2: 分步运行

#### 步骤 1: 运行策略
```bash
uv run freqtrade trade --config config_demo.json --dry-run
```

#### 步骤 2: 开启另一个终端监控
```bash
uv run python monitor_only.py
```

## 📊 监控界面展示

### 实时监控界面
```
🔄 AdvancedMarketMakerV2 实时监控
⏰ 更新时间: 2024-09-02 15:30:45
================================================================================

📊 当前持仓 (4 个):
--------------------------------------------------------------------------------
ID   交易对       方向   数量           开仓价     持续时间   盈亏率
--------------------------------------------------------------------------------
5    BTC/USDT     多头   0.005000      49950.0000 8m        0.12%
6    BTC/USDT     空头   0.005000      50050.0000 6m        0.08%
7    BTC/USDT     多头   0.005000      49900.0000 4m        0.15%
8    BTC/USDT     空头   0.005000      50100.0000 2m        0.05%

📈 最近完成的交易:
--------------------------------------------------------------------------------
ID   交易对       方向   数量           开仓价     平仓价     盈亏率    原因
--------------------------------------------------------------------------------
4    BTC/USDT     多头   0.005000      49980.0000 50020.0000 0.08%     roi
3    BTC/USDT     空头   0.005000      50120.0000 50080.0000 0.08%     roi
2    BTC/USDT     多头   0.005000      49920.0000 49960.0000 0.08%     roi

📊 交易统计:
   总交易: 8 | 进行中: 4 | 已完成: 4
   胜率: 100.0% | 平均盈亏: 0.08% | 累计盈亏: 0.0320

📦 库存状态:
----------------------------------------------------------------------
交易对       多头数量       空头数量       净持仓         平衡状态
----------------------------------------------------------------------
BTC/USDT     0.010000      0.010000      0.000000      ✅ 平衡

💡 提示:
   - 策略使用干跑模式，不会真实交易
   - 做市商策略同时开多空单来赚取价差
   - 理想状态是多空持仓保持平衡
   - 按 Ctrl+C 退出监控

📊 监控间隔: 10秒
```

## 🔍 关键监控指标说明

### 1. **持仓监控**
- **多头持仓**: 买入的 BTC 数量，等待价格上涨
- **空头持仓**: 卖出的 BTC 数量，等待价格下跌
- **净持仓**: 多头 - 空头，理想情况应接近 0
- **平衡状态**: 
  - ✅ 平衡: 失衡率 < 10%
  - ⚠️ 轻微失衡: 失衡率 10-30%
  - ❌ 严重失衡: 失衡率 > 30%

### 2. **盈利机制**
```
做市商盈利原理:
当前价格: 50000 USDT

策略同时下单:
├── 买单: 49950 USDT (-0.1%)  ← 等待价格下跌成交
└── 卖单: 50050 USDT (+0.1%)  ← 等待价格上涨成交

双边成交后:
买入成本: 49950 USDT
卖出收益: 50050 USDT
价差利润: 100 USDT (0.2%)
```

### 3. **库存平衡**
- **平衡状态**: 多空持仓相等，风险中性
- **偏多**: 多头持仓过多，面临价格下跌风险
- **偏空**: 空头持仓过多，面临价格上涨风险

## ⚡ 快速命令

### 基本操作
```bash
# 快速启动
uv run python run_simple.py

# 仅监控（需要策略已在运行）
uv run python monitor_only.py

# 手动运行策略
uv run freqtrade trade --config config_demo.json --dry-run

# 下载最新数据
uv run freqtrade download-data --config config_demo.json --timeframe 1m --timerange 20240901-
```

### 数据查看
```bash
# 查看数据库内容
sqlite3 demo_trades.sqlite "SELECT * FROM trades ORDER BY open_date DESC LIMIT 10;"

# 查看日志
tail -f logs/freqtrade_demo.log

# 检查配置
cat config_demo.json | grep -A5 -B5 "strategy\|pair_whitelist"
```

## 🎯 使用建议

### 1. **观察做市效果**
- 关注多空仓位是否保持平衡
- 查看价差是否能持续盈利
- 监控交易频率和成交率

### 2. **参数调优**
如果发现问题，可以调整配置文件中的参数：

```json
// config_demo.json 中的策略参数
{
  "strategy_parameters": {
    "spread_ratio": 0.002,           // 价差比例，影响盈利空间
    "base_order_amount_ratio": 0.005, // 订单大小，影响资金利用率
    "inventory_rebalance_threshold": 0.2  // 库存再平衡阈值
  }
}
```

### 3. **常见调优场景**

**成交率低（订单很少成交）**
```json
"spread_ratio": 0.001  // 减小价差，提高成交概率
```

**库存经常失衡**
```json
"inventory_rebalance_threshold": 0.1  // 降低阈值，更积极平衡
```

**交易过于频繁**
```json
"process_throttle_secs": 10  // 增加处理间隔
```

## 🔧 故障排除

### 策略不下单
```bash
# 检查日志中的错误信息
tail -f logs/freqtrade_demo.log | grep -i "error\|warning"

# 常见原因:
# - 市场波动率过高
# - 价差计算异常
# - 数据获取失败
```

### 监控脚本无数据
```bash
# 检查数据库是否存在
ls -la demo_trades.sqlite

# 检查策略是否正在运行
ps aux | grep freqtrade
```

### 库存严重失衡
```bash
# 检查市场是否出现单边趋势
# 考虑调整库存管理参数
# 或暂停策略等待市场回归震荡
```

## 💡 进阶技巧

### 1. **多终端监控**
```bash
# 终端1: 运行策略
uv run freqtrade trade --config config_demo.json --dry-run

# 终端2: 实时监控
uv run python monitor_only.py

# 终端3: 查看详细日志
tail -f logs/freqtrade_demo.log | grep "AdvancedMarketMakerV2"
```

### 2. **数据分析**
```bash
# 导出交易数据进行分析
sqlite3 -header -csv demo_trades.sqlite "SELECT * FROM trades;" > trades_export.csv
```

### 3. **性能监控**
```bash
# 监控系统资源
htop

# 监控网络连接
netstat -an | grep 443  # HTTPS 连接到交易所
```

现在你有了一个完全无 webserver 的简洁版本，专注于命令行运行和监控！🚀