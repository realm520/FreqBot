---
name: strategy-21
description: 量化网格动态调仓策略 - 基于网格交易原理结合动态仓位管理的自适应交易策略
status: backlog
created: 2025-09-06T04:07:40Z
---

# PRD: strategy-21 - 量化网格动态调仓策略

## Executive Summary

Strategy-21 是一个基于网格交易原理的动态调仓策略，通过在预设价格区间内设置多个买卖网格，结合市场波动率和趋势强度动态调整仓位大小，实现在震荡市场中的稳定套利。该策略特别适合波动性较高但趋势不明显的加密货币市场，通过高频小额交易累积收益。

## Problem Statement

### 当前挑战
1. **传统网格策略局限性**：固定网格间距和仓位在极端行情下表现不佳
2. **资金利用率低**：静态网格配置导致大量资金闲置
3. **趋势市场适应性差**：纯网格策略在单边行情中容易踏空或深套
4. **风险管理粗放**：缺乏动态风控机制，容易在黑天鹅事件中遭受重大损失

### 为什么现在重要
- 加密货币市场进入震荡期，网格策略优势明显
- 市场波动率维持高位，提供充足套利空间
- 交易所手续费降低，高频交易成本可控
- 量化交易工具成熟，支持复杂策略实现

## User Stories

### 主要用户角色

#### 1. 震荡市场交易者（Primary）
**背景**：专注于区间交易，在无明显趋势的市场中寻找机会
**需求**：
- 作为震荡市场交易者，我需要自动化的网格交易，以便全天候捕捉价格波动
- 作为震荡市场交易者，我需要动态调整网格参数，以适应市场波动率变化
- 作为震荡市场交易者，我需要清晰的盈亏统计，以评估策略效果

**接受标准**：
- 网格自动调整响应时间 < 1分钟
- 日内交易次数 > 20次（高波动期）
- 震荡市月收益率 > 5%

#### 2. 风险厌恶型投资者（Secondary）
**背景**：追求稳定收益，不愿承担过高风险
**需求**：
- 作为保守投资者，我需要严格的止损机制，以控制最大损失
- 作为保守投资者，我需要仓位自动管理，避免过度暴露
- 作为保守投资者，我需要实时风险监控，了解当前风险敞口

**接受标准**：
- 最大回撤 < 10%
- 单笔最大损失 < 总资金2%
- 风险预警准确率 > 90%

#### 3. 量化策略研究员（Tertiary）
**背景**：研究和优化交易策略，需要详细数据支持
**需求**：
- 作为研究员，我需要完整的交易日志，用于策略分析
- 作为研究员，我需要参数回测功能，验证优化效果
- 作为研究员，我需要可视化分析工具，直观展示策略表现

**接受标准**：
- 支持至少30个参数组合回测
- 回测速度 > 1年数据/分钟
- 导出数据格式支持CSV/JSON

## Requirements

### Functional Requirements

#### 核心功能

##### FR1: 网格生成与管理
- **FR1.1** 等差/等比网格生成（支持两种模式）
- **FR1.2** 动态网格间距调整（基于ATR）
- **FR1.3** 网格数量优化（5-50格可配置）
- **FR1.4** 价格区间自动识别（基于支撑阻力）
- **FR1.5** 网格重置机制（突破区间后重新布局）

##### FR2: 动态仓位管理
- **FR2.1** 基于波动率的仓位调整（高波动减仓）
- **FR2.2** 趋势强度仓位系数（0.5-1.5倍基础仓位）
- **FR2.3** 资金分配算法（均匀/金字塔/倒金字塔）
- **FR2.4** 仓位再平衡（每小时检查）
- **FR2.5** 应急平仓机制（极端行情一键清仓）

##### FR3: 交易执行逻辑
- **FR3.1** 限价单网格挂单
- **FR3.2** 成交后自动补单
- **FR3.3** 部分成交处理
- **FR3.4** 订单超时撤销（可配置时间）
- **FR3.5** 滑点保护（最大滑点0.2%）

##### FR4: 风险控制系统
- **FR4.1** 网格止损线（区间下限-5%）
- **FR4.2** 网格止盈线（区间上限+5%）
- **FR4.3** 总资金止损（-8%强制停止）
- **FR4.4** 单日亏损限制（-3%暂停交易）
- **FR4.5** 连续亏损熔断（连续5笔亏损暂停）

##### FR5: 市场分析模块
- **FR5.1** 波动率计算（ATR/标准差）
- **FR5.2** 趋势识别（MA/EMA交叉）
- **FR5.3** 支撑阻力位检测
- **FR5.4** 成交量分析
- **FR5.5** 市场情绪指标（恐贪指数集成）

##### FR6: 监控与报告
- **FR6.1** 实时P&L展示
- **FR6.2** 网格状态可视化
- **FR6.3** 成交记录详情
- **FR6.4** 收益率曲线图
- **FR6.5** 策略诊断报告（日报/周报）

### Non-Functional Requirements

#### 性能要求
- **NFR1** 订单响应延迟 < 50ms
- **NFR2** 支持同时运行10个网格策略
- **NFR3** 每秒处理100个价格更新
- **NFR4** 内存占用 < 1GB
- **NFR5** CPU占用 < 20%（稳定运行时）

#### 可靠性要求
- **NFR6** 系统可用性 > 99.9%
- **NFR7** 断线自动重连（3秒内）
- **NFR8** 订单状态同步（每30秒）
- **NFR9** 数据持久化（每笔交易实时保存）
- **NFR10** 异常恢复（自动恢复未完成订单）

#### 安全性要求
- **NFR11** API密钥加密存储（AES-256）
- **NFR12** 交易签名验证
- **NFR13** 异常交易拦截（超出预设范围）
- **NFR14** 操作日志审计
- **NFR15** 双重验证（大额操作）

#### 兼容性要求
- **NFR16** FreqTrade框架兼容
- **NFR17** 支持主流交易所（Binance/OKX/Bybit）
- **NFR18** Python 3.12+环境
- **NFR19** 跨平台运行（Linux/Mac/Windows）
- **NFR20** Docker容器化部署

## Success Criteria

### 量化指标
1. **收益指标**
   - 震荡市月收益率 > 5%
   - 年化收益率 > 30%
   - 收益稳定性（月度标准差） < 3%

2. **风险指标**
   - 最大回撤 < 10%
   - 夏普比率 > 2.0
   - 胜率 > 60%
   - 平均盈亏比 > 1.2

3. **运营指标**
   - 日均交易次数: 20-100次
   - 资金利用率 > 80%
   - 策略运行时间 > 95%

### 定性指标
- 用户配置简便性（10分钟内完成配置）
- 策略稳定性（无需日常干预）
- 市场适应性（多种市场状态下盈利）

## Constraints & Assumptions

### 约束条件
1. **技术约束**
   - 必须基于FreqTrade框架
   - 使用Python 3.12+
   - 单机运行环境

2. **资金约束**
   - 最小启动资金: 1000 USDT
   - 单网格最小金额: 10 USDT
   - 最大管理资金: 100,000 USDT

3. **市场约束**
   - 仅支持现货交易
   - 交易对需有足够流动性
   - 不支持杠杆交易

### 假设条件
1. 市场维持一定波动率（日波动 > 2%）
2. 交易所API稳定可用
3. 网络延迟 < 100ms
4. 历史数据可获取（至少3个月）
5. 交易手续费 < 0.1%

## Out of Scope

以下功能不在本次开发范围内：
1. **期货/合约交易**（需要额外的保证金管理）
2. **跨交易所套利**（需要复杂的资金调度）
3. **机器学习优化**（使用传统技术分析）
4. **社交跟单功能**（专注于独立策略）
5. **手动交易干预**（全自动化运行）
6. **多币种组合**（单币种网格）
7. **期权策略结合**（仅现货网格）
8. **高频抢单**（专注于网格交易）

## Dependencies

### 外部依赖
1. **交易所接口**
   - CCXT统一接口库
   - WebSocket实时数据流
   - REST API历史数据

2. **技术指标库**
   - TA-Lib（技术分析）
   - Pandas（数据处理）
   - NumPy（数值计算）

3. **基础设施**
   - Redis（订单缓存）
   - SQLite（交易记录）
   - Prometheus（监控指标）

### 内部依赖
1. **FreqBot核心**
   - 策略基类
   - 配置管理器
   - 执行引擎
   - 风控模块

2. **共享组件**
   - 市场数据服务
   - 订单管理器
   - 性能分析器
   - 日志系统

## Risk Analysis

### 技术风险
- **高**：网格密集导致API限流 → 缓解：请求频率控制，批量下单
- **中**：极端行情导致网格失效 → 缓解：动态调整和熔断机制
- **低**：回测过拟合 → 缓解：滚动窗口验证

### 市场风险
- **高**：单边趋势导致连续亏损 → 缓解：趋势识别和策略切换
- **中**：流动性不足导致无法成交 → 缓解：流动性检测和动态调整
- **低**：手续费侵蚀利润 → 缓解：精确计算和最小利润保护

### 操作风险
- **中**：配置错误导致异常交易 → 缓解：参数验证和模拟确认
- **低**：系统故障导致持仓失控 → 缓解：定期状态同步和恢复机制

## Implementation Plan

### 第1阶段：基础网格（第1周）
- 实现基础网格生成逻辑
- 完成订单管理基础功能
- 集成FreqTrade框架

### 第2阶段：动态调整（第2周）
- 实现动态仓位管理
- 添加市场分析模块
- 完成参数自适应逻辑

### 第3阶段：风险控制（第3周）
- 实现完整风控体系
- 添加异常处理机制
- 完成监控告警功能

### 第4阶段：测试优化（第4周）
- 全面回测验证
- 模拟交易测试
- 性能优化调优
- 文档编写完善

## Metrics & KPIs

### 开发阶段KPI
- 代码覆盖率 > 85%
- 单元测试通过率 100%
- 回测验证准确率 > 95%

### 运行阶段KPI
- 策略启动时间 < 10秒
- 订单执行成功率 > 99%
- 系统崩溃恢复时间 < 1分钟

### 业务KPI
- 用户激活率 > 70%
- 用户留存率（30天） > 60%
- 策略盈利用户占比 > 65%

## Appendix

### 参考资料
1. 网格交易策略原理与实践
2. 动态仓位管理算法研究
3. FreqTrade策略开发最佳实践
4. 加密货币市场微观结构分析

### 测试数据
- 基于提供的21.png回测报告
- 历史回测显示策略在震荡市表现良好
- 需要更多市场状态下的测试验证

### 相关策略
- GridTradingStrategy（静态网格）
- MarketMakerStrategy（做市策略）
- MeanReversionStrategy（均值回归）